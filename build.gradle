


import javax.xml.transform.stream.*
import javax.xml.transform.TransformerFactory


class TestXsltTask extends DefaultTask {

	def xslPath = "src/main/xslt/tessy-to-junit.xsl"
	def xslt = new File(xslPath).getText()
   def transformer = TransformerFactory.newInstance().newTransformer(new StreamSource(new StringReader(xslt)))

	def toXunit( String inputPath) {

		def inputFile = new File(inputPath)
		def tessy = inputFile.getText()

		def outputFile = getTemporaryDir().createTempFile("test",".xml")

		logger.info("${inputFile } ->  ${outputFile}")
		def junit = new FileOutputStream(outputFile)

		transformer.transform(new StreamSource(new StringReader(tessy)), new StreamResult(junit))
		return outputFile
	}

   @TaskAction
	def test() {
	  def output = toXunit("src/test/xslt/allpass/input.xml")
	}
}

task test(type: TestXsltTask){

}


task wrapper(type: Wrapper) {
    gradleVersion = '4.0'
}
